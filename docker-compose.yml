version: '2'
services:
    frontend:
        image: nginx
        restart: always
        ports:
            - "${DOCKER_EXTERNAL_IP}:80:80"
            - "${DOCKER_EXTERNAL_IP}:443:443"
        volumes:
            - "/home/docker/data/nginx/ssl:/etc/nginx/ssl:ro"
            - "/home/docker/munki_repo:/srv/munki_repo:ro"
            - "/home/docker/data/nginx/conf.d:/etc/nginx/conf.d:ro"
    unifi:
        image: rednut/unifi-controller
        restart: always
        ports:
            - "${DOCKER_EXTERNAL_IP}:8080:8080"
        volumes:
            - unifi_data:/usr/lib/unifi/data
    zabbix-db:
        image: zabbix/zabbix-db-mariadb
        restart: always
        environment:
            - MARIADB_USER=zabbix
            - MARIADB_PASS=otWocnv4fmeA3r
        volumes:
            - "/home/docker/data/zabbix-backups:/backups"
            - "/etc/localtime:/etc/localtime:ro"
            - zabbixdb_data:/var/lib/mysql
    zabbix:
        image: zabbix/zabbix-3.0:latest
        restart: always
        environment:
            - ZS_DBHost=zabbix-db
            - ZS_DBUser=zabbix
            - ZS_DBPassword=otWocnv4fmeA3r
        ports:
            - "${DOCKER_EXTERNAL_IP}:10051:10051"
        volumes:
            - "/etc/localtime:/etc/localtime:ro"
            - "/home/docker/data/zabbix/etc/snmp:/etc/snmp:ro"
            - "/home/docker/data/zabbix/mibs:/usr/share/snmp/mibs:ro"
    mongo-graylog:
        image: "mongo:3"
        volumes:
            - /home/docker/data/graylog/mongo:/data/db
    elasticsearch-graylog:
        image: "elasticsearch:2"
        command: "elasticsearch -Des.cluster.name='graylog'"
        volumes:
            - /home/docker/data/graylog/elasticsearch:/usr/share/elasticsearch/data
    graylog:
        image: graylog2/server:2.0.2-1
        volumes:
            - /home/docker/data/graylog/journal:/usr/share/graylog/data/journal
            - /home/docker/data/graylog/config:/usr/share/graylog/data/config
        environment:
            GRAYLOG_REST_TRANSPORT_URI: http://127.0.0.1:12900
        links:
            - mongo-graylog:mongo
            - elasticsearch-graylog:elasticsearch
        ports:
            - "${DOCKER_EXTERNAL_IP}:12900:12900"
            - "${DOCKER_EXTERNAL_IP}:514:514"

volumes:
    unifi_data:
        external: true
    zabbixdb_data:
        external: true
