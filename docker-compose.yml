# vim: et:ts=4:sw=4
version: '2'
services:
    frontend:
        image: nginx
        restart: always
        ports:
            - "80:80"
            - "443:443"
        volumes:
            - "/storage/repos/docker-config/nginx/ssl:/etc/nginx/ssl:ro"
            - "/storage/repos/docker-config/nginx/conf.d:/etc/nginx/conf.d:ro"
            - "/storage/mac/munki_repo:/srv/munki_repo:ro"
    unifi:
        image: rednut/unifi-controller:v5.2.7
        build:
            context: https://github.com/overhacked/docker-unifi-controller.git#unifi5
        restart: always
        ports:
            - "8080:8080" # INFORM
            - "3478:3478/udp" # STUN
        volumes:
            - /storage/unifi-data:/usr/lib/unifi/data
    transmission:
        image: linuxserver/transmission
        restart: always
        ports:
            - "9091:9091"
            - "51413:51413"
            - "51413:51413/udp"
        volumes:
            - "/storage/repos/docker-config/transmission:/config"
            - "/storage/export/downloads:/downloads"
            - "/storage/export/downloads/torrents:/watch"
        environment:
            - TZ="America/New_York"
    zabbix-db:
        image: monitoringartist/zabbix-db-mariadb
        volumes:
            - zabbix-db-storage:/var/lib/mysql
            - /storage/backup/docker/zabbix:/backups
            - /etc/localtime:/etc/localtime:ro
        environment:
            - MARIADB_USER=zabbix
            - MARIADB_PASS=otWocnv4fmeA3r
    zabbix-server:
        image: monitoringartist/zabbix-xxl:latest
        depends_on:
            - zabbix-db
        ports:
            - "10051:10051"
        volumes:
            - /etc/localtime:/etc/localtime:ro
            - /storage/repos/docker-config/zabbix/etc/snmp:/etc/snmp:ro
            - /storage/repos/docker-config/zabbix/mibs:/usr/share/snmp/mibs:ro
        links:
            - zabbix-db:zabbix.db
        environment:
            - ZS_DBHost=zabbix.db
            - ZS_DBUser=zabbix
            - ZS_DBPassword=otWocnv4fmeA3r
    reposado:
        #image: macadmins/reposado
        build:
            context: https://github.com/overhacked/docker-reposado.git#uwsgi-nginx
        restart: always
        environment:
            - LOCALCATALOGURLBASE="https://updates.manyfoldfarm.com:443"
        volumes:
            - /storage/mac/swupdate/html:/reposado/html
            - /storage/mac/swupdate/metadata:/reposado/metadata
            - /storage/repos/docker-config/reposado/preferences.plist:/reposado/code/preferences.plist
volumes:
    zabbix-db-storage:
        driver: local
